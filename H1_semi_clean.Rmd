---
title: "H1: Gender Differences"
author: "Mariola Paruzel-Czachura, Cillian McHugh"
date: "`r format(Sys.time(), '%d %B, %Y')`"
bibliography: "resources/bib/My Library.bib"
csl: "resources/bib/apa.csl"
output:
  bookdown::html_document2:
    fig_caption: yes
    toc: true
    toc_float:
      toc_collapsed: false
    toc_depth: 4
    number_sections: false
editor_options: 
  chunk_output_type: console
---

<style>
  .superbigimage{
      overflow-x:scroll;
      white-space: nowrap;
  }

  .superbigimage img{
     max-width: none;
  }


</style>


```{r setuph1, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(include = FALSE)
```


```{r}
rm(list = ls())
library(tidyverse)
library(plyr)
library(psych)
library(skimr)
library(corrplot)
library(Hmisc)
#library(psy)
library(afex)
#devtools::install_github("cillianmiltown/R_desnum")
library(desnum)
library(papaja)
library(purrr)
#install.packages("interactions")
library(interactions)
library(kableExtra)
#devtools::install_github("crsh/papaja")
library("papaja")
library(lme4)
library(car)
library(ggplot2)
library(nlme)
#install.packages("reshape")
library(reshape)
library(corx)
library(lsr)
#install.packages("Cairo")
#library(Cairo)
library(foreign)
library(ltm)
library("ggpubr")
#install.packages("rworldmap")
library(rworldmap)
#devtools::install_github("rensa/ggflags")
library(ggflags)
#devtools::install_github("schliebs/ggoxford")
library(ggoxford)
library(ggforce)
library(ggbeeswarm)
library(countrycode)
```




```{r}

#source("set_up_data_calculate_means.R")
load("data/data_with_means_semi_clean.RData")

df$sex3 <- as.factor(df$sex1)
df$sex3 <- dplyr::recode(df$sex3,
               "1"="male"
              ,"2"="female"
              ,"3"="other")

df$country_lower <- tolower(df$country)
df$country_name <- countrycode(df$ISO3, origin = "iso3c", destination = "country.name")

```


```{r}


## Internalization 

alpha_generic <- function(x){
  df <- x
  
  df$moralid4R <- reverse.code(c(-1), df$moralid4)
  df$moralid7R <- reverse.code(-1, df$moralid7)
  
  y <- subset(df,select=c(
    moralid1
    , moralid2
    , moralid4R
    , moralid7R
    , moralid10
  ))
  cronbach.alpha(y[complete.cases(y),])
}

alpha_generic(df)

## Symbolization

alpha_generic <- function(x){
  df <- x
  y <- subset(df,select=c(
    moralid3
  , moralid5
  , moralid6
  , moralid8
  , moralid9
))
  cronbach.alpha(y[complete.cases(y),])
}

alpha_generic(df)

```


```{r}

x <- df

table(x$sex3)
x <- x[which(x$sex3!="other"),]
x$sex3 <- droplevels(x$sex3)

t1 <- t.test(x$moral_identity_internal ~ x$sex3)
d1 <- cohen.d(x$moral_identity_internal, x$sex3)

d1$cohen.d[2]
sprintf("%.1f",mean(x$moral_identity_internal[which(x$sex3=='female')],na.rm=T))
sprintf("%.1f",sd(x$moral_identity_internal[which(x$sex3=='female')],na.rm=T))
sprintf("%.2f",t1$parameter)
sprintf("%.2f",t1$statistic)

t2 <- t.test(x$moral_identity_symbolic ~ x$sex3)
d2 <- cohen.d(x$moral_identity_symbolic, x$sex3)


```

Our first hypothesis was that women would have higher levels of internalization and symbolization than men. To test this we isolated the data for men and women from the main dataset. An independent samples t-test revealed that for the entire sample, women had higher internalization scores (*M* = `r sprintf("%.1f",mean(x$moral_identity_internal[which(x$sex3=='female')],na.rm=T))`, *SD* = `r sprintf("%.1f",sd(x$moral_identity_internal[which(x$sex3=='female')],na.rm=T))`), than men (*M* = `r sprintf("%.1f",mean(x$moral_identity_internal[which(x$sex3=='male')],na.rm=T))`, *SD* = `r sprintf("%.1f",sd(x$moral_identity_internal[which(x$sex3=='male')],na.rm=T))`), *t*(`r sprintf("%.2f",t1$parameter)`) = `r sprintf("%.2f",t1$statistic)`, *p* `r paste(p_report(t1$p.value))`, *d* = `r sprintf("%.2f", d1$cohen.d[2])`. Similarly, for symbolization, an independent samples t-test revealed that for the entire sample, women had higher scores (*M* = `r sprintf("%.1f",mean(x$moral_identity_symbolic[which(x$sex3=='female')],na.rm=T))`, *SD* = `r sprintf("%.1f",sd(x$moral_identity_symbolic[which(x$sex3=='female')],na.rm=T))`), than men (*M* = `r sprintf("%.1f",mean(x$moral_identity_symbolic[which(x$sex3=='male')],na.rm=T))`, *SD* = `r sprintf("%.1f",sd(x$moral_identity_symbolic[which(x$sex3=='male')],na.rm=T))`), *t*(`r sprintf("%.2f",t2$parameter)`) = `r sprintf("%.2f",t2$statistic)`, *p* `r paste(p_report(t2$p.value))`, *d* = `r sprintf("%.2f", d2$cohen.d[2])`.


```{r}

x <- df

table(x$sex3)
x <- x[which(x$sex3!="other"),]
x$sex3 <- droplevels(x$sex3)

x$sex_01 <-  dplyr::recode(x$sex3,
               "male"="0"
              ,"female"="1")

model0 <- lmerTest::lmer(moral_identity_internal ~
                 #  sex_01
                 # * age
                  + (1|country)
                , data = x
                # , contrasts = list(sex3 = contr.sum, valence = contr.sum )
            )

model1 <- lmerTest::lmer(moral_identity_internal ~
                    sex_01
                 # * age
                  + (1|country)
                , data = x
               # , contrasts = list(sex_01 = contr.sum)
            )
summary(model1)
anova(model0,model1)


summary(model1)
anova(model1)
results_anova <- as.data.frame(anova(model0,model1))
results_anova
results_anova$Chisq[2]
results_anova$Df
p1 <- results_anova$`Pr(>Chisq)`[2]
p_report(p1)
#p_report(results_anova$`Pr(>Chisq)`)[2]
results_anova$AIC
summary_model1 <- summary(model1)
summary_model1
results_coef <- as.data.frame(summary_model1$coefficients)
results_coef

aov1 <- anova(model1)

f3a <- aov1$`F value`[1]
p3a <- aov1$`Pr(>F)`[1]


results_coef$Estimate[2]
results_coef$`Std. Error`[2]
results_coef$df[2]
t1 <- results_coef$`t value`[2]
p2 <- results_coef$`Pr(>|t|)`[2]

#QuantPsyc::lm.beta(results_coef)
anova(model1)
```



```{r}

#### ensure correct data is loaded ####
x <- df[which(df$sex3=="male"|df$sex3=="female"),]
x$sex3 <- droplevels(x$sex3)



#### remove any missing data #### 
sum(is.na(x$moral_identity_internal))
x <- x[which(is.na(x$moral_identity_internal)==FALSE),]
table(x$country_name,x$sex3)
x$country_name



#### group by country ####
x <- x %>% group_by(country_name) %>% do(data = (.)) %>% with( set_names(data, country_name) )



#### identify countries with small samples
male_length <- function(x){sum(x$sex3=='male')}
males <- lapply(x, male_length)
female_length <- function(x){sum(x$sex3=='female')}
females <- lapply(x, female_length)
names(females)

#### generate a vector containing all countries with less than 10 observations for either males or females ####
exclusions <- c(names(males[males<2]),
  names(females[females<2]))

#### re-load ungrouped data ####
x <- df[which(df$sex3=="male"|df$sex3=="female"),]
x$sex3 <- droplevels(x$sex3)
x$sex_01 <-  dplyr::recode(x$sex3,
               "male"="0"
              ,"female"="1")

# and remove missing again
sum(is.na(x$moral_identity_internal))
x <- x[which(is.na(x$moral_identity_internal)==FALSE),]

#### Filter out any countries to be excluded ####
x <- subset(x, !(country_name %in% exclusions))

#### group by country for analysis ####
x <- x %>% group_by(country_name) %>% do(data = (.)) %>% with( set_names(data, country_name) )

regression_fun <- function(x){
  fit <- lm(moral_identity_internal~sex_01+age, data = x)
  summary(fit)
}


all_regressions <- lapply(x, regression_fun)
all_regression_ps <- function(y){
  y$coefficients[11]
}
lapply(all_regressions, all_regression_ps)
regression_ps_for_table <- lapply(lapply(all_regressions, all_regression_ps), p_report)

ttest_fun <- function(x){
  t.test(moral_identity_internal ~ sex3, data = x)
}
all_t_tests <- lapply(x, ttest_fun)

means_fun <- function(x){
  mean(x$moral_identity_internal)
}
lapply(x, means_fun)
sd_fun <- function(x){
  sd(x$moral_identity_internal)
}
lapply(x, sd_fun)

cohens_d_fun <- function(x){
  cohen.d(x$moral_identity_symbolic, x$sex3)
}
all_ds <- lapply(x, cohens_d_fun)
show_d_fun <- function(x){
  x$cohen.d[2]
}
ds_for_table <- lapply(all_ds, show_d_fun)

all_t_stats <- function(t){
  t$statistic
}
ts_for_table <- lapply(all_t_tests, all_t_stats)

all_t_df <- function(t){
  t$parameter
}
df_for_table <- lapply(all_t_tests, all_t_df)

all_t_ps <- function(t){
  t$p.value
}
ps_for_table <- lapply((lapply(all_t_tests, all_t_ps)), p_report)
raw_ps_for_table <- (lapply(all_t_tests, all_t_ps))


total_sig <- sum(unlist(lapply(all_t_tests, all_t_ps))<.05)

#### means for Males ####
# re-load ungrouped data #
x <- df[which(df$sex3=="male"
              #|df$sex3=="female"
              ),]
x$sex3 <- droplevels(x$sex3)

# and remove missing again
sum(is.na(x$moral_identity_internal))
x <- x[which(is.na(x$moral_identity_internal)==FALSE),]
x <- subset(x, !(country_name %in% exclusions))


x <- x %>% group_by(country_name) %>% do(data = (.)) %>% with( set_names(data, country_name) )
male_means <- lapply(x, means_fun)
male_sds <- lapply(x, sd_fun)

#### means for Females
# re-load ungrouped data #
x <- df[which(df$sex3=="female"
              #|df$sex3=="female"
              ),]
x$sex3 <- droplevels(x$sex3)

# and remove missing again
sum(is.na(x$moral_identity_internal))
x <- x[which(is.na(x$moral_identity_internal)==FALSE),]
x <- subset(x, !(country_name %in% exclusions))


x <- x %>% group_by(country_name) %>% do(data = (.)) %>% with( set_names(data, country_name) )
female_means <- lapply(x, means_fun)
female_sds <- lapply(x, sd_fun)

mean(df$moral_identity_internal,na.rm=T)
mean(df$moral_identity_symbolic,na.rm=T)

```



```{r}
test <- 
  cbind.data.frame(
     round(do.call(rbind, female_means),digits=2)
    ,round(do.call(rbind, female_sds),digits=2)
    ,round(do.call(rbind, male_means),digits=2)
    ,round(do.call(rbind, female_sds),digits=2)
    ,round(do.call(rbind, ts_for_table),digits=2)
    ,round(do.call(rbind, df_for_table),digits=2)
    ,do.call(rbind, raw_ps_for_table)
    ,round(do.call(rbind, ds_for_table),digits=2)
    )

test_with_regression <- 
  cbind.data.frame(
     round(do.call(rbind, female_means),digits=2)
    ,round(do.call(rbind, female_sds),digits=2)
    ,round(do.call(rbind, male_means),digits=2)
    ,round(do.call(rbind, female_sds),digits=2)
    ,round(do.call(rbind, ts_for_table),digits=2)
    ,round(do.call(rbind, df_for_table),digits=2)
    ,do.call(rbind, ps_for_table)
    ,do.call(rbind, regression_ps_for_table)
    ,round(do.call(rbind, ds_for_table),digits=2)
    )


test_with_regression <- `colnames<-`(test_with_regression, c("mean F","SD F","mean M", "SD M", "t","df","p","p2","d"))
test_with_regression

test <- `colnames<-`(test, c("mean F","SD F","mean M", "SD M", "t","df","p","d"))
test

sum(unlist(lapply(all_t_tests, all_t_ps))<.05)


test1 <- subset(test, p < .05)


neg <- sum(test1$`mean F`<test1$`mean M`)
pos <- sum(test1$`mean F`>test1$`mean M`)

c1 <- paste0(rownames(test1[which(test1$`mean F`<test1$`mean M`),]))[1]
c2 <- paste0(rownames(test1[which(test1$`mean F`<test1$`mean M`),]))[2]

```


We conducted a linear-mixed-effects model to test for gender differences in internalization when participants are nested within country. Our outcome measure was internalization and our predictor variable was binary gender (coded as 0 = *male*; 1 = *female*); we allowed intercepts to vary by country.
Overall, the model significantly predicted internalization, and provided a better fit for the data than the baseline model,
$\chi$^2^(`r results_anova$Df[2]`) = `r sprintf("%.2f",results_anova$Chisq[2])`, *p* `r paste(p_report(p1))`. 
There was a significant main effect for gender,
*F*(`r aov1$NumDF[1]`, `r sprintf("%.2f",round(aov1$DenDF[1],digits=2))`) = 
`r sprintf("%.2f",f3a)`, *p* `r paste(p_report(p3a))`;
with a significant positive association between being female and higher internalization scores, $b$ = `r sprintf("%.2f",results_coef$Estimate[2])`,
*t*(`r sprintf("%.2f",results_coef$df[2])`) = 
`r sprintf("%.2f",t1)`,
*p* `r paste(p_report(p2))`.
We conducted a series of independent-samples t-tests to test for gender differences in internalization across all countries.  We found significant gender differences in internalization across `r total_sig` countries. Of these, `r pos` were in the predicted direction, while in `r neg` countries (`r c1` and `r c2`), males showed higher internalization than females (see Supplementary Materials [Table S_X](https://cillianmiltown.github.io/moral_ID_gender/drafting_supplementary_analysis.html#Internalization_Table)).


```{r}

x <- df

table(x$sex3)
x <- x[which(x$sex3!="other"),]
x$sex3 <- droplevels(x$sex3)

x$sex_01 <-  dplyr::recode(x$sex3,
               "male"="0"
              ,"female"="1")

model0 <- lmerTest::lmer(moral_identity_symbolic ~
                 #  sex_01
                 # * age
                  + (1|country)
                , data = x
                # , contrasts = list(sex3 = contr.sum, valence = contr.sum )
            )

model1 <- lmerTest::lmer(moral_identity_symbolic ~
                    sex_01
                 # * age
                  + (1|country)
                , data = x
              #  , contrasts = list(sex_01 = contr.sum)
            )
summary(model1)
anova(model0,model1)


summary(model1)
anova(model1)
results_anova <- as.data.frame(anova(model0,model1))
results_anova
results_anova$Chisq[2]
results_anova$Df
p1 <- results_anova$`Pr(>Chisq)`[2]
p_report(p1)
#p_report(results_anova$`Pr(>Chisq)`)[2]
results_anova$AIC
summary_model1 <- summary(model1)
summary_model1
results_coef <- as.data.frame(summary_model1$coefficients)
results_coef

aov1 <- anova(model1)

f3a <- aov1$`F value`[1]
p3a <- aov1$`Pr(>F)`[1]


results_coef$Estimate[2]
results_coef$`Std. Error`[2]
results_coef$df[2]
t1 <- results_coef$`t value`[2]
p2 <- results_coef$`Pr(>|t|)`[2]

#QuantPsyc::lm.beta(results_coef)
anova(model1)
```


```{r}

#### ensure correct data is loaded ####
x <- df[which(df$sex3=="male"|df$sex3=="female"),]
x$sex3 <- droplevels(x$sex3)

#### remove any missing data #### 
sum(is.na(x$moral_identity_symbolic))
x <- x[which(is.na(x$moral_identity_symbolic)==FALSE),]
table(x$country_name,x$sex3)
x$country_name

#### group by country ####
x <- x %>% group_by(country_name) %>% do(data = (.)) %>% with( set_names(data, country_name) )

#### identify countries with small samples
male_length <- function(x){sum(x$sex3=='male')}
males <- lapply(x, male_length)
female_length <- function(x){sum(x$sex3=='female')}
females <- lapply(x, female_length)
names(females)

#### generate a vector containing all countries with less than 10 observations for either males or females ####
exclusions <- c(names(males[males<2]),
  names(females[females<2]))

#### re-load ungrouped data ####
x <- df[which(df$sex3=="male"|df$sex3=="female"),]
x$sex3 <- droplevels(x$sex3)

# and remove missing again
sum(is.na(x$moral_identity_symbolic))
x <- x[which(is.na(x$moral_identity_symbolic)==FALSE),]

#### Filter out any countries to be excluded ####
x <- subset(x, !(country_name %in% exclusions))

#### group by country for analysis ####
x <- x %>% group_by(country_name) %>% do(data = (.)) %>% with( set_names(data, country_name) )

ttest_fun <- function(x){
  t.test(moral_identity_symbolic ~ sex3, data = x)
}
all_t_tests <- lapply(x, ttest_fun)

means_fun <- function(x){
  mean(x$moral_identity_symbolic)
}
lapply(x, means_fun)
sd_fun <- function(x){
  sd(x$moral_identity_symbolic)
}
lapply(x, sd_fun)

cohens_d_fun <- function(x){
  cohen.d(x$moral_identity_symbolic, x$sex3)
}
all_ds <- lapply(x, cohens_d_fun)
show_d_fun <- function(x){
  x$cohen.d[2]
}
ds_for_table <- lapply(all_ds, show_d_fun)

all_t_stats <- function(t){
  t$statistic
}
ts_for_table <- lapply(all_t_tests, all_t_stats)

all_t_df <- function(t){
  t$parameter
}
df_for_table <- lapply(all_t_tests, all_t_df)

all_t_ps <- function(t){
  t$p.value
}
ps_for_table <- lapply((lapply(all_t_tests, all_t_ps)), p_report)
raw_ps_for_table <- (lapply(all_t_tests, all_t_ps))


total_sig <- sum(unlist(lapply(all_t_tests, all_t_ps))<.05)

#### means for Males ####
# re-load ungrouped data #
x <- df[which(df$sex3=="male"
              #|df$sex3=="female"
              ),]
x$sex3 <- droplevels(x$sex3)

# and remove missing again
sum(is.na(x$moral_identity_symbolic))
x <- x[which(is.na(x$moral_identity_symbolic)==FALSE),]
x <- subset(x, !(country_name %in% exclusions))


x <- x %>% group_by(country_name) %>% do(data = (.)) %>% with( set_names(data, country_name) )
male_means <- lapply(x, means_fun)
male_sds <- lapply(x, sd_fun)

#### means for Females
# re-load ungrouped data #
x <- df[which(df$sex3=="female"
              #|df$sex3=="female"
              ),]
x$sex3 <- droplevels(x$sex3)

# and remove missing again
sum(is.na(x$moral_identity_symbolic))
x <- x[which(is.na(x$moral_identity_symbolic)==FALSE),]
x <- subset(x, !(country_name %in% exclusions))


x <- x %>% group_by(country_name) %>% do(data = (.)) %>% with( set_names(data, country_name) )
female_means <- lapply(x, means_fun)
female_sds <- lapply(x, sd_fun)

```

```{r}
test <- 
  cbind.data.frame(
     round(do.call(rbind, female_means),digits=2)
    ,round(do.call(rbind, female_sds),digits=2)
    ,round(do.call(rbind, male_means),digits=2)
    ,round(do.call(rbind, female_sds),digits=2)
    ,round(do.call(rbind, ts_for_table),digits=2)
    ,round(do.call(rbind, df_for_table),digits=2)
    ,do.call(rbind, raw_ps_for_table)
    ,round(do.call(rbind, ds_for_table),digits=2)
    )

test <- `colnames<-`(test, c("mean F","SD F","mean M", "SD M", "t","df","p","d"))
test

sum(unlist(lapply(all_t_tests, all_t_ps))<.05)


test1 <- subset(test, p < .05)


neg <- sum(test1$`mean F`<test1$`mean M`)
pos <- sum(test1$`mean F`>test1$`mean M`)

c1 <- paste0(rownames(test1[which(test1$`mean F`<test1$`mean M`),]))[1]
c2 <- paste0(rownames(test1[which(test1$`mean F`<test1$`mean M`),]))[2]

```


We conducted another linear-mixed-effects model to test for gender differences in symbolization when participants are nested within country. Our outcome measure was symbolization and our predictor variable was binary gender (coded as 0 = *male*; 1 = *female*); we allowed intercepts to vary by country.
Overall, the model significantly predicted symbolization, and provided a better fit for the data than the baseline model,
$\chi$^2^(`r results_anova$Df[2]`) = `r sprintf("%.2f",results_anova$Chisq[2])`, *p* `r paste(p_report(p1))`. 
There was a significant main effect for gender,
*F*(`r aov1$NumDF[1]`, `r sprintf("%.2f",round(aov1$DenDF[1],digits=2))`) = 
`r sprintf("%.2f",f3a)`, *p* `r paste(p_report(p3a))`;
with a significant positive association between being female and higher symbolization scores, $b$ = `r sprintf("%.2f",results_coef$Estimate[2])`,
*t*(`r sprintf("%.2f",results_coef$df[2])`) = 
`r sprintf("%.2f",t1)`,
*p* `r paste(p_report(p2))`.
We conducted a series of independent-samples t-tests to test for gender differences in symbolization across all countries. We found significant gender differences in symbolization across `r total_sig` countries. Of these, `r pos` were in the predicted direction, while in `r neg` countries (`r c1` and `r c2`), males showed higher symbolization than females (see Supplementary Materials [Table S_X](https://cillianmiltown.github.io/moral_ID_gender/drafting_supplementary_analysis.html#Symbolization_Table)).





```{r internalizationPlot}

x <- df[which(df$sex3=="male"|df$sex3=="female"),]
x$sex3 <- droplevels(x$sex3)

df1 <- x

df1_male <- df1[which(df1$sex3=="male"),]
df1_female <- df1[which(df1$sex3=="female"),]

internal_mean_sd <- function(x){
  z <- x
  z$mean <- mean(z$moral_identity_internal, na.rm=T)
  z$sd <- sd(z$moral_identity_internal, na.rm=T)
  z
}


df1 <- rbind.data.frame(
  internal_mean_sd(df1_female),
  internal_mean_sd(df1_male)
)

df1$sex3 <- dplyr::recode(df1$sex3
                           , "male" = "Male"
                           , "female" = "Female")

g1 <- ggplot(df1,aes(x=sex3,y=moral_identity_internal))+
  geom_jitter(shape=16, position=position_jitter(height = .5, width = .45), size=.001, color="lightgrey")+
  geom_violin(fill = NA) +
  #ggforce::geom_sina(size=.01)+
  # geom_sina(shape=16
  #           , position=position_jitter(height=.25,width=0)
  #           , size=.000001
  #           , color="dark grey"
  #           ,jitter_y=F
  # )+
  geom_boxplot(width=0.1, outlier.shape = NA, color='grey')+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.06,
               position=position_dodge(0.05), color="#5a5a5a")+
  stat_summary(fun=mean, geom="point", shape=16, size=2)+
  # stat_summary(geom = "linerange",
  #   fun.data = mean_sdl, 
  #   fun.args = list(mult = 1),
  #   colour = "black"
  # )+
  xlab("Gender")+
  ylab("Internalization")+  
  #geom_jitter(shape=16, position=position_jitter(height = .5, width = .45), size=.01, color="dark grey")
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
       # panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
          size=12
        ),
        #legend.position="right",
        legend.text=element_text(#family="Times",
          size=8
        ),
        legend.title=element_text(#family="Times",
          size=10
        ),
        axis.text=element_text(#family="Times",
          colour = "black",
          size=8
        ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
          size=12
        ),
        strip.text=element_text(#family = "Times",
          size = 12
        ),
        # strip.background = element_rect(fill = "white"),
        legend.position="none")
  
#g1
```


```{r symbolizationPlot}

x <- df[which(df$sex3=="male"|df$sex3=="female"),]
x$sex3 <- droplevels(x$sex3)

df1 <- x

symbolic_mean_sd <- function(x){
  z <- x
  z$mean <- mean(z$moral_identity_symbolic, na.rm=T)
  z$sd <- sd(z$moral_identity_symbolic, na.rm=T)
  z
}

df1 <- rbind.data.frame(
  symbolic_mean_sd(df1_female),
  symbolic_mean_sd(df1_male)
)

df1$sex3 <- dplyr::recode(df1$sex3
                           , "male" = "Male"
                           , "female" = "Female")

# df1 <- df
g2 <- ggplot(df1,aes(x=sex3,y=moral_identity_symbolic))+
  geom_jitter(shape=16, position=position_jitter(height = .5, width = .45), size=.001, color="lightgrey")+
  geom_violin(fill = NA) +
  #ggforce::geom_sina(size=.01)+
  # geom_sina(shape=16
  #           , position=position_jitter(height=.25,width=0)
  #           , size=.000001
  #           , color="dark grey"
  #           ,jitter_y=F
  # )+
  #geom_quasirandom(size=.1)+
  geom_boxplot(width=0.1, outlier.shape = NA, color='grey')+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.06,
               position=position_dodge(0.05), color="#5a5a5a")+
  stat_summary(fun=mean, geom="point", shape=16, size=2)+
  # stat_summary(geom = "linerange",
  #   fun.data = mean_sdl, 
  #   fun.args = list(mult = 1),
  #   colour = "black"
  # )+
  xlab("Gender")+
  ylab("Symbolization")+  
  #geom_jitter(shape=16, position=position_jitter(height = .5, width = .45), size=.01, color="dark grey")
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
     #   panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
          size=12
        ),
        #legend.position="right",
        legend.text=element_text(#family="Times",
          size=8
        ),
        legend.title=element_text(#family="Times",
          size=10
        ),
        axis.text=element_text(#family="Times",
          colour = "black",
          size=8
        ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
          size=12
        ),
        strip.text=element_text(#family = "Times",
          size = 12
        ),
        # strip.background = element_rect(fill = "white"),
        legend.position="none")
  
#g2
```

```{r, combinePlots, include=FALSE}
figure <- ggarrange(g1
                    , g2
                    #,labels = c("A")
                    , ncol = 1
                    , nrow = 2
                    #, widths = c(0.485, 0.5)
)
figure
```

```{r, meanSymbolizationGender,include=TRUE}
suppressWarnings(print(figure))

```
